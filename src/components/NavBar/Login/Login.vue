<template>
  <div class="login">
    <div v-show="loggedOut" id="google-signin-button"></div>
    <v-menu v-if="!loggedOut && !mobile" offset-y>
      <template v-slot:activator="{ on }">
        <v-btn v-on="on" x-small fab color="#eeeeee">
          <div class="first-letter">{{ userFirstLetter }}</div>
        </v-btn>
      </template>
      <v-list>
        <v-list-item @click="openMyUploads">
          <v-list-item-icon>
            <v-icon>{{ mdiFileDocumentMultiple }}</v-icon>
          </v-list-item-icon>
          <v-list-item-content>
            <v-list-item-title>My Uploads</v-list-item-title>
          </v-list-item-content>
        </v-list-item>
        <v-list-item @click="signOut">
          <v-list-item-icon>
            <v-icon>{{ mdiLogout }}</v-icon>
          </v-list-item-icon>
          <v-list-item-content>
            <v-list-item-title>Sign out</v-list-item-title>
          </v-list-item-content>
        </v-list-item>
      </v-list>
    </v-menu>
    <v-list-item @click="openMyUploads" v-if="mobile && !loggedOut">
      <v-list-item-icon>
        <v-icon>{{ mdiFileDocumentMultiple }}</v-icon>
      </v-list-item-icon>
      <v-list-item-content>
        <v-list-item-title>My Uploads</v-list-item-title>
      </v-list-item-content>
    </v-list-item>
    <v-list-item @click="signOut" v-if="mobile && !loggedOut">
      <v-list-item-icon>
        <v-icon>{{ mdiLogout }}</v-icon>
      </v-list-item-icon>
      <v-list-item-content>
        <v-list-item-title>Sign out</v-list-item-title>
      </v-list-item-content>
    </v-list-item>
  </div>
</template>
<script lang='ts'>
import { Component, Vue, Prop, Watch } from "vue-property-decorator";
import state, { signIn, signOut } from "@/store/driveStore";
import { mdiFileDocumentMultiple, mdiLogout } from "@mdi/js";

/**
 * Login/Logout of Google
 */
@Component({
  components: {},
})
export default class Login extends Vue {
  @Prop({ type: Boolean, default: false })
  private mobile!: boolean;

  private mdiFileDocumentMultiple = mdiFileDocumentMultiple;
  private mdiLogout = mdiLogout;

  private get loggedOut() {
    return state.user === null;
  }

  private get userFirstLetter() {
    if (state.user) {
      return state.user.getBasicProfile().getName().slice(0, 1);
    }
    return null;
  }

  private mounted() {
    signIn("google-signin-button");
  }

  private signOut() {
    signOut();
  }

  private openMyUploads() {
    /**
     * Navigate to the user uploads page
     */
    this.$emit("jumpTo", { name: "Uploads" });
  }
}
</script>
<style lang="scss" scoped>
.login {
  position: relative;
  top: 7px;
  .first-letter {
    font-size: 18px;
    color: #37474f;
  }
}
</style>